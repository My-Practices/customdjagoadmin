{% extends "admin/base_site.html" %} {% load i18n static %} {% block extrastyle %}
<link rel="stylesheet" type="text/css" href="{% static " admin/css/dashboard.css " %}" />
<link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.css" />
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="http://momentjs.com/downloads/moment.min.js"></script>
<script src="https://momentjs.com/downloads/moment-with-locales.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.min.js"></script>
<style>
.dashboard #content {
    width: 70%;
}
</style>
<script type="text/javascript">
$(document).ready(function() {
    $('#calendar').fullCalendar({
        //height: 600,
        locale: 'es',
        header: {
            left: 'prev,next today',
            center: 'title',
            // right: 'month,basicWeek,basicDay,listWeek'
            right: 'agendaDay,agendaWeek,listWeek,listDay,listMonth',
            // right: 'month,agendaWeek,agendaDay,listWeek,listDay,listMonth,listYear,list',
        },
        defaultView: 'agendaWeek',
        buttonText: {
            today: 'Hoy',
            //month: 'Ver por Mes',
            week: 'Semana',
            day: 'Día',
            listDay: 'Lista dia',
            listWeek: 'Lista semana',
            listMonth: 'Lista mes',
            listYear: 'Lista año',
        },
        eventClick: function(calEvent, jsEvent, view) {
            if (calEvent.isOwner) {
                var myConfirm = confirm("¿Quieres eliminar?");
                if (myConfirm) {
                    console.log('')
                }
            }

            //calEvent.color
            //calEvent.title 
            //calEvent.start._i 
            //calEvent.estado
            //$("#eliminar-cita").attr("href", "/cita/eliminar/" + calEvent.pkd + "/");
        },
        // header: {
        //     left: '',
        //     center: 'prev title next',
        //     right: ''
        // },
        //defaultDate: '2016-01-12',
        selectable: true,

        eventLimit: true, // allow "more" link when too many events
        //selectHelper: true,
        editable: true,
        //resize: true,
        //slotMinutes: 60,
        navLinks: true,
        allDaySlot: false, //para mostar en el calendario todo el dia
        //scrollTime: '08:00:00',
        //minTime: "00:00:00",
        //maxTime: "18:00:00",
        selectOverlap: false,
        slotEventOverlap: false, //para que no se pueda poner encima mas o la misma hora
        //weekends: false, //si incluye fin de semanas or //hiddenDays: [ 1, 3, 5 ]
        //droppable: true, // this allows things to be dropped onto the calendar
        selectHelper: true,
        select: function(start, end) {
            var title = confirm("¿Estas seguro que deseas separar ese horario?");
            if (title) {
                $.ajax({
                    url: '/cp/eventos/',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        start: moment(start).format("YYYY-MM-DD HH:mm:ss"),
                        end: moment(end).format("YYYY-MM-DD HH:mm:ss"),
                        course: '{{original.pk}}',
                    },
                });
                location.reload();
                //$('#calendar').fullCalendar('unselect');
            }
        },
        eventResize: function(event, delta, revertFunc) {
            console.log(event);
            console.log(delta);
            console.log(revertFunc);
            alert(event.title + " end is now " + event.end.format());
            if (!confirm("is this okay?")) {
                revertFunc();
            }
        },
        /*events: [
                {
                    title: 'All Day Event',
                    start: '2017-02-01'
                },
                {
                    title: 'Long Event',
                    start: '2017-02-07',
                    end: '2017-02-10'
                },
                {
                    id: 999,
                    title: 'Repeating Event',
                    start: '2017-02-09T16:00:00'
                },
                {
                    id: 999,
                    title: 'Repeating Event',
                    start: '2017-02-16T16:00:00'
                },
                {
                    title: 'Conference',
                    start: '2017-02-11',
                    end: '2017-02-13'
                },
                {
                    title: 'Meeting',
                    start: '2017-02-12T10:30:00',
                    end: '2017-02-12T12:30:00'
                },
                {
                    title: 'Lunch',
                    start: '2017-02-12T12:00:00'
                },
                {
                    title: 'Meeting',
                    start: '2017-02-12T14:30:00'
                },
                {
                    title: 'Happy Hour',
                    start: '2017-02-12T17:30:00'
                },
                {
                    title: 'Dinner',
                    start: '2017-02-12T20:00:00'
                },
                {
                    title: 'Birthday Party',
                    start: '2017-02-13T07:00:00'
                },
                {
                    title: 'Click for Google',
                    url: 'http://google.com/',
                    start: '2017-02-28'
                }
            ],*/
        /*select: function(start, end, date) {
            selectCita = {};
            $('#myModal').modal({
                backdrop: 'static',
                keyboard: false
            });
            $("#id_evento").val("");
            $('#id_date').val(moment(start).format("YYYY-MM-DD HH:mm:ss"));
            // var title = prompt('Event Title:');
            // var events;
            // if (title) {
            //     events = {
            //         title: title,
            //         start: start,
            //         end: end
            //     };
            //     $('#calendar').fullCalendar('renderEvent', events, true); // stick? = true
            // }
            // $('#calendar').fullCalendar('unselect');
        },*/
        events: function(start, end, timezone, callback) {
            $.ajax({
                    url: '/cp/eventos/',
                    type: 'get',
                    dataType: 'json',
                    data: {
                        id: '{{ original.pk }}',
                    },
                })
                .done(function(dat) {
                    console.log(dat)
                    callback(dat);
                })
                .fail(function() {
                    console.log("error");
                })
                .always(function() {
                    console.log("complete");
                });

        },
        viewRender: function(currentView) {
            var minDate = moment().subtract(1, 'weeks'),
                maxDate = moment().add(2, 'weeks');
            // Past
            if (minDate >= currentView.start && minDate <= currentView.end) {
                $(".fc-prev-button").prop('disabled', true);
                $(".fc-prev-button").addClass('fc-state-disabled');
            } else {
                $(".fc-prev-button").removeClass('fc-state-disabled');
                $(".fc-prev-button").prop('disabled', false);
            }
            // Future
            if (maxDate >= currentView.start && maxDate <= currentView.end) {
                $(".fc-next-button").prop('disabled', true);
                $(".fc-next-button").addClass('fc-state-disabled');
            } else {
                $(".fc-next-button").removeClass('fc-state-disabled');
                $(".fc-next-button").prop('disabled', false);
            }
        },
        // events: [
        // {
        //     title: 'Conference',
        //     start: YESTERDAY,
        //     end: TOMORROW,
        //     color: 'yellow',
        //     textColor: 'red',
        //     backgroundColor: 'blue',
        //     borderColor: 'green',
        //     //editable:false,
        //     overlap: false, //If false, prevents this event from being dragged/resized over other events. ///EVITA la sobreposicion
        // },]

    });

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });
});
</script>{% endblock %} {% block bodyclass %}{{ block.super }} dashboard{% endblock %} {% block content %}
<div id="content-main">
    <div id='calendar'></div>
</div>
{% endblock %}
